name = "blazesportsintel"
compatibility_date = "2025-01-01"
pages_build_output_dir = "."

# ============================================================================
# D1 DATABASE CONFIGURATION
# ============================================================================
# Created: 2025-10-01
# Database ID: cbafed34-782f-4bf1-a14b-4ea49661e52b
# Run migrations: wrangler d1 execute blazesports-db --file=schema/001_initial_schema.sql
[[d1_databases]]
binding = "DB"
database_name = "blazesports-db"
database_id = "cbafed34-782f-4bf1-a14b-4ea49661e52b"

# ============================================================================
# KV NAMESPACES (API Caching)
# ============================================================================
# Using existing CACHE namespace
# ID: a53c3726fc3044be82e79d2d1e371d26
[[kv_namespaces]]
binding = "CACHE"
id = "a53c3726fc3044be82e79d2d1e371d26"

# ============================================================================
# R2 BUCKETS (Embeddings Storage for AI Copilot)
# ============================================================================
# Created for Scouting Intel Copilot feature
# Stores embeddings as Float32 binary data for semantic search
# Create with: wrangler r2 bucket create bsi-embeddings
[[r2_buckets]]
binding = "EMBEDDINGS"
bucket_name = "bsi-embeddings"

# ============================================================================
# VECTORIZE INDEX (Semantic Search for AI Copilot)
# ============================================================================
# 768-dimensional embeddings using bge-base-en-v1.5 model
# Cosine similarity metric for sports scouting intelligence search
# Create with: wrangler vectorize create sports-scouting-index --dimensions=768 --metric=cosine
[[vectorize]]
binding = "VECTOR_INDEX"
index_name = "sports-scouting-index"

# ============================================================================
# WORKERS AI (Embeddings + LLM for AI Copilot)
# ============================================================================
# Provides access to:
#   - @cf/baai/bge-base-en-v1.5 (768-dim embeddings)
#   - @cf/meta/llama-3.1-8b-instruct (text generation)
[ai]
binding = "AI"

# ============================================================================
# ANALYTICS ENGINE (Performance Monitoring)
# ============================================================================
# UPDATED: 2025-10-11 - Analytics Engine now enabled for Pages Functions
# Tracks production metrics:
#   - Request performance and response times
#   - Error rates and types
#   - Cache hit/miss ratios
#   - Data validation success rates
#   - Per-sport API usage patterns
#
# Middleware location: functions/api/_middleware.js
# Query with: wrangler analytics query bsi-analytics --start-date YYYY-MM-DD
[[analytics_engine_datasets]]
binding = "ANALYTICS"
dataset = "bsi-analytics"

# ============================================================================
# ENVIRONMENT VARIABLES (Secrets)
# ============================================================================
# Set these as secrets (DO NOT commit actual values to git):
# wrangler pages secret put SPORTSDATA_API_KEY --project-name blazesportsintel
# wrangler pages secret put ANTHROPIC_API_KEY --project-name blazesportsintel

# ============================================================================
# CRON TRIGGERS (Scheduled Data Updates)
# ============================================================================
# Note: Cloudflare Pages doesn't support cron triggers in wrangler.toml
# Cron jobs will be configured via Cloudflare Dashboard after deployment
# Or convert to separate Workers with cron triggers
#
# Recommended schedule:
# - NFL: Every 5 minutes (Sep-Feb) - */5 * * 9-12,1-2 *
# - MLB: Every 10 minutes (Mar-Oct) - */10 * * 3-10 *
# - CFB: Every 15 minutes (Aug-Jan) - */15 * * 8-12,1 *
# - CBB: Every 20 minutes (Nov-Mar) - */20 * * 11-12,1-3 *
# - College Baseball: Every 15 minutes (Feb-Jun) - */15 * * 2-6 *

# ============================================================================
# ROUTES & FUNCTIONS
# ============================================================================
# All routes in /functions are automatically deployed as Workers Functions
# API endpoints: /api/{sport}/[[route]]
# Scheduled jobs: /scheduled/update-{sport}

# ============================================================================
# SECURITY NOTES
# ============================================================================
# 1. All API keys must be set as secrets via wrangler CLI
# 2. Never commit secrets to version control
# 3. Use environment-specific bindings for staging/production
# 4. Set secrets with: wrangler pages secret put <KEY> --project-name blazesportsintel
#
# Required secrets:
#   - SPORTSDATA_API_KEY (SportsDataIO API key)
#   - ANTHROPIC_API_KEY (Claude chat assistant)

# ============================================================================
# DEPLOYMENT COMMANDS
# ============================================================================
# Create D1 database:
#   wrangler d1 create blazesports-db
#
# Run database migration:
#   wrangler d1 execute blazesports-db --file=schema/001_initial_schema.sql
#
# Create KV namespace:
#   wrangler kv:namespace create CACHE
#   wrangler kv:namespace create CACHE --preview
#
# Create R2 bucket (AI Copilot):
#   wrangler r2 bucket create bsi-embeddings
#
# Create Vectorize index (AI Copilot):
#   wrangler vectorize create sports-scouting-index --dimensions=768 --metric=cosine
#
# Create Analytics Engine dataset (Monitoring):
#   wrangler analytics create-dataset blazesports-analytics
#   Note: Analytics datasets are automatically created on first write
#
# Set secrets:
#   wrangler pages secret put SPORTSDATA_API_KEY --project-name blazesportsintel
#   wrangler pages secret put ANTHROPIC_API_KEY --project-name blazesportsintel
#
# Query analytics:
#   wrangler analytics query blazesports-analytics \
#     --start-date 2025-10-01 --end-date 2025-10-10
#
# Deploy to production:
#   wrangler pages deploy . --project-name blazesportsintel --branch main